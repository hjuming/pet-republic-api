# ===============================
# ğŸ¾ å¯µå…’å…±å’Œåœ‹ APIï¼ˆPet Republic APIï¼‰
# Cloudflare Workers éƒ¨ç½²è¨­å®š
# ===============================

name = "pet-republic-api"
main = "src/index.js"
compatibility_date = "2024-10-01"
workers_dev = true

# ===============================
# ğŸŒ è·¯ç”±è¨­å®š
# ===============================
# è‹¥ä½¿ç”¨ Cloudflare å„€è¡¨æ¿æ‰‹å‹•ç¶å®šè‡ªè¨‚ç¶²åŸŸï¼Œå¯ä¿ç•™è¨»è§£ï¼›
# è‹¥æƒ³æ”¹ç”± toml æ§åˆ¶ï¼Œå¯è§£é™¤è¨»è§£ä¸¦ç¢ºèª patternã€‚
# routes = [
#   { pattern = "image.wedo.pet/*", zone_name = "wedo.pet" }
# ]

# ===============================
# â° Cron å®šæ™‚è§¸ç™¼ï¼ˆæ¯ 10 åˆ†é˜ï¼‰
# ===============================
[triggers]
crons = ["*/10 * * * *"]

# ===============================
# ğŸ—„ï¸ D1 è³‡æ–™åº«ç¶å®š
# ===============================
[[d1_databases]]
binding = "DATABASE"                        # åœ¨ç¨‹å¼å…§ç”¨ env.DATABASE å‘¼å«
database_name = "image-db"                  # D1 è³‡æ–™åº«åç¨±
database_id = "243fe99c-70d9-4d4d-89e7-d3dd3b58dadf"  # âœ… ä½ çš„ D1 ID

# ===============================
# â˜ï¸ R2 å„²å­˜æ¡¶ç¶å®š
# ===============================
[[r2_buckets]]
binding = "R2_BUCKET"                       # åœ¨ç¨‹å¼å…§ç”¨ env.R2_BUCKET å‘¼å«
bucket_name = "my-images-bucket"            # R2 å„²å­˜æ¡¶åç¨±

# ===============================
# âš™ï¸ éæ©Ÿå¯†ç’°å¢ƒè®Šæ•¸ï¼ˆå®‰å…¨å¯å…¬é–‹ï¼‰
# ===============================
[vars]
# æœ€å¤§å…è¨±åœ–ç‰‡å¤§å° (MB)
MAX_IMAGE_MB = "20"

# CORS å…è¨±ä¾†æºï¼ˆç”¨æ–¼åœ–ç‰‡èˆ‡ APIï¼‰
CORS_ALLOW_ORIGIN = "https://image.wedo.pet"

# ===============================
# ğŸ”’ æ©Ÿå¯†å€¼ï¼ˆç”± GitHub Actions è‡ªå‹•è¨­å®šï¼‰
# ===============================
# ä»¥ä¸‹è®Šæ•¸åœ¨ wrangler.toml ä¸éœ€å¡«å€¼ï¼Œæœƒç”± workflow è‡ªå‹• wrangler secret putï¼š
#   AIRTABLE_API_TOKEN
#   AIRTABLE_BASE_ID
#   AIRTABLE_TABLE_NAME
#   USERNAME
#   PASSWORD
#   DOMAIN

# ===============================
# ğŸš€ éƒ¨ç½²èˆ‡é–‹ç™¼æ³¨æ„äº‹é …
# ===============================
# - é–‹ç™¼æ¸¬è©¦å¯ç”¨ `wrangler dev` åœ¨æœ¬åœ°å•Ÿå‹•æ¨¡æ“¬ã€‚
# - æ­£å¼éƒ¨ç½²è«‹ä½¿ç”¨ GitHub Actionsï¼ˆdeploy.ymlï¼‰ã€‚
# - éœ€ç¢ºä¿ CLOUDFLARE_API_TOKEN å…·å‚™ä»¥ä¸‹æ¬Šé™ï¼š
#     * Workers Scripts:Edit, Workers KV Storage:Edit,
#       Workers R2 Storage:Edit, D1:Edit
# - è‹¥æ›´æ›å¸³è™Ÿæˆ– R2/D1 åç¨±ï¼Œå‹™å¿…åŒæ­¥æ›´æ–°æ­¤æª”æ¡ˆã€‚
