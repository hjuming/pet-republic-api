# ========= 基本 =========
name = "pet-republic-api"
main = "src/index.js"
compatibility_date = "2024-10-01"
workers_dev = true

# 明寫帳號 ID，避免 CI 上解析落空
account_id = "d7700d5b696e5584f6c1fcc028b6e803"

# ========= Vars =========
[vars]
# 會在 default 環境生效；注意：不會自動繼承到 env.production
MAX_IMAGE_MB = "20"

# ========= R2（預設環境）=========
[[r2_buckets]]
binding = "R2_BUCKET"
bucket_name = "my-images-bucket"

# ========= D1（預設環境）=========
[[d1_databases]]
# 程式碼中使用的綁定名稱（請保持 DATABASE）
binding = "DATABASE"
# D1 儀表板上的「名稱」
database_name = "image-db"
# 遷移檔目錄（確保 wrangler 能找到）
migrations_dir = "migrations"
# ⚠️ 嚴禁在方案 A 寫 database_id！讓 wrangler 用名稱自動解析

# ========= Cron（選填）=========
[triggers]
crons = ["*/30 * * * *"]

# ========= production 環境 =========
[env.production]
# 再明寫 account_id（與上方一致，避免 CI 情境解析落空）
account_id = "d7700d5b696e5584f6c1fcc028b6e803"

# production 不會自動繼承上層 vars，請補上需要的變數
[env.production.vars]
MAX_IMAGE_MB = "20"

[[env.production.r2_buckets]]
binding = "R2_BUCKET"
bucket_name = "my-images-bucket"

[[env.production.d1_databases]]
binding = "DATABASE"
database_name = "image-db"
migrations_dir = "migrations"
# ⚠️ 同樣不要寫 database_id
