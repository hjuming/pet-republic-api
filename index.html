<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Pet Republic｜商品清單</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 text-gray-800">
<header class="sticky top-0 z-10 bg-white/90 backdrop-blur border-b">
  <div class="max-w-6xl mx-auto px-4 py-4 flex items-center gap-3">
    <h1 class="text-2xl font-extrabold">Pet Republic｜商品清單</h1>
    <div class="flex-1"></div>
    <input id="q" placeholder="輸入關鍵字或 SKU" class="w-80 max-w-[60vw] rounded-lg border px-4 py-2" />
    <button id="btnSearch" class="ml-2 rounded-lg bg-teal-600 text-white px-4 py-2 hover:bg-teal-700">搜尋</button>
    <a href="/admin" class="ml-3 rounded-lg bg-gray-800 text-white px-4 py-2 hover:bg-black">後台</a>
  </div>
</header>

<main class="max-w-6xl mx-auto px-4 py-6">
  <div class="mb-3 flex flex-wrap gap-3 items-center">
    <button id="btnToggle" class="rounded-lg border px-4 py-2">切換：縮圖 / 列表</button>
    <button id="btnExport" class="rounded-lg bg-green-700 text-white px-4 py-2">匯出選取 CSV</button>
    <button id="btnZip" class="rounded-lg bg-indigo-600 text-white px-4 py-2">打包圖片 ZIP</button>
  </div>

  <div id="cards" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"></div>

  <div class="mt-6 flex gap-3">
    <button id="prev" class="rounded-lg border px-4 py-2">上一頁</button>
    <button id="next" class="rounded-lg border px-4 py-2">下一頁</button>
  </div>

  <pre id="debug" class="mt-6 hidden bg-gray-900 text-white p-3 rounded"></pre>
</main>

<script>
const state = { page: 1, size: 20, view: "card", q: "" };
const $ = (id)=>document.getElementById(id);
const cards = $("cards");

function render(items){
  cards.innerHTML = "";
  if(!items.length){
    cards.innerHTML = '<div class="text-gray-500">目前沒有資料</div>';
    return;
  }
  for(const p of items){
    const box = document.createElement("div");
    box.className = "rounded-xl bg-white shadow p-4 flex flex-col gap-2";
    const img = (p.images?.[0]) ? \`<img src="\${p.images[0]}" class="w-full aspect-video object-cover rounded-lg border"/>\` : "";
    box.innerHTML = \`
      \${img}
      <div class="text-sm text-gray-500">\${p.brand || "-"}｜\${p.category || "-"}</div>
      <div class="text-lg font-bold">\${p.sku}</div>
      <div class="text-base">\${p.name || ""}</div>
      <div class="text-sm text-gray-500">狀態：\${p.status || "-"}</div>
    \`;
    cards.appendChild(box);
  }
}

async function load(){
  const url = new URL("/api/products", location.origin);
  url.searchParams.set("page", state.page);
  url.searchParams.set("size", state.size);
  if(state.q) url.searchParams.set("q", state.q);
  const res = await fetch(url);
  const data = await res.json();
  render(data.items || []);
}

$("btnSearch").onclick = ()=>{ state.q = $("q").value.trim(); state.page = 1; load(); };
$("prev").onclick = ()=>{ if(state.page>1){ state.page--; load(); } };
$("next").onclick = ()=>{ state.page++; load(); };

load();
</script>
</body>
</html>
